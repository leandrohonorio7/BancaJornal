<UserControl x:Class="BancaJornal.Desktop.Views.VendaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Loaded="UserControl_Loaded">
    
    <Grid Background="{StaticResource BackgroundColor}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Seleção de Produtos -->
        <Border Grid.Column="0" Background="{StaticResource SurfaceColor}" 
                CornerRadius="8" Padding="20" Margin="0,0,10,0">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Produtos Disponíveis" 
                           FontSize="20" FontWeight="Bold" Margin="0,0,0,15"/>

                <!-- Busca Rápida -->
                <Grid Grid.Row="1" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Text="{Binding BuscaProduto, UpdateSourceTrigger=PropertyChanged}" />
                    <Button Grid.Column="1" Content="Buscar" 
                            Command="{Binding BuscarProdutosCommand}" Width="100"/>
                </Grid>

                <!-- Lista de Produtos -->
                <DataGrid Grid.Row="2" ItemsSource="{Binding ProdutosDisponiveis}" 
                          SelectedItem="{Binding ProdutoSelecionado}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*"/>
                        <DataGridTextColumn Header="Preço" 
                                            Binding="{Binding PrecoVenda, StringFormat='R$ {0:N2}'}" 
                                            Width="100"/>
                        <DataGridTextColumn Header="Estoque" Binding="{Binding QuantidadeEstoque}" 
                                            Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Adicionar Item -->
                <Grid Grid.Row="3" Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Quantidade:" VerticalAlignment="Center" 
                               Margin="0,0,10,0" FontSize="14"/>
                    <TextBox Grid.Column="1" Text="{Binding QuantidadeItem, UpdateSourceTrigger=PropertyChanged}" 
                             Width="80" HorizontalAlignment="Left"/>
                    <Button Grid.Column="2" Content="Adicionar à Venda" 
                            Command="{Binding AdicionarItemCommand}" 
                            Width="150" Background="#4CAF50"/>
                </Grid>
            </Grid>
        </Border>

        <!-- Carrinho de Venda -->
        <Border Grid.Column="1" Background="{StaticResource SurfaceColor}" 
                CornerRadius="8" Padding="20">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Itens da Venda" 
                           FontSize="20" FontWeight="Bold" Margin="0,0,0,15"/>

                <!-- Itens da Venda -->
                <DataGrid Grid.Row="1" ItemsSource="{Binding ItensVenda}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Produto" Binding="{Binding NomeProduto}" Width="*"/>
                        <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="50"/>
                        <DataGridTextColumn Header="Valor" 
                                            Binding="{Binding ValorTotal, StringFormat='R$ {0:N2}'}" 
                                            Width="90"/>
                        <DataGridTemplateColumn Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="X" 
                                            Command="{Binding DataContext.RemoverItemCommand, 
                                                     RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Background="#F44336" Width="30" Height="25"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Observação -->
                <StackPanel Grid.Row="2" Margin="0,15,0,0">
                    <TextBlock Text="Observação" FontSize="12" 
                               Foreground="{StaticResource TextSecondaryColor}"/>
                    <TextBox Text="{Binding Observacao, UpdateSourceTrigger=PropertyChanged}" 
                             Height="50" TextWrapping="Wrap" AcceptsReturn="True"/>
                </StackPanel>

                <!-- Valor Total -->
                <Border Grid.Row="3" Background="{StaticResource PrimaryColor}" 
                        CornerRadius="4" Padding="15" Margin="0,15,0,0">
                    <Grid>
                        <TextBlock Text="VALOR TOTAL:" FontSize="16" Foreground="White" 
                                   HorizontalAlignment="Left" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ValorTotal, StringFormat='R$ {0:N2}'}" 
                                   FontSize="24" FontWeight="Bold" Foreground="White" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Botões de Ação -->
                <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,15,0,0">
                    <Button Content="Finalizar Venda" Command="{Binding FinalizarVendaCommand}" 
                            Width="150" Background="#4CAF50"/>
                    <Button Content="Cancelar" Command="{Binding IniciarNovaVendaCommand}" 
                            Width="100" Background="#757575"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
