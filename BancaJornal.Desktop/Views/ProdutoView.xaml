<UserControl x:Class="BancaJornal.Desktop.Views.ProdutoView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:BancaJornal.Desktop.Converters"
             Loaded="UserControl_Loaded">
    <UserControl.Resources>
        <conv:BoolToTextConverter x:Key="BoolToTextConverter"
                                  TrueText="Edição"
                                  FalseText="Novo Produto"/>
        
        <conv:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </UserControl.Resources>
    <Grid Background="{StaticResource BackgroundColor}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Lista de Produtos -->
        <Border Grid.Column="0" Background="{StaticResource SurfaceColor}" 
                CornerRadius="8" Padding="20" Margin="0,0,10,0">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Gerenciamento de Produtos" 
                           FontSize="20" FontWeight="Bold" Margin="0,0,0,15"/>

                <!-- Busca -->
                <Grid Grid.Row="1" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Text="{Binding FiltroNome, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Grid.Column="1" Content="Buscar" Command="{Binding BuscarCommand}" 
                            Width="100"/>
                </Grid>

                <!-- Grid de Produtos -->
                <DataGrid Grid.Row="2" ItemsSource="{Binding Produtos}" 
                          SelectedItem="{Binding ProdutoSelecionado}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                        <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*"/>
                        <DataGridTextColumn Header="Preço" 
                                            Binding="{Binding PrecoVenda, StringFormat='R$ {0:N2}'}" 
                                            Width="100"/>
                        <DataGridTextColumn Header="Estoque" Binding="{Binding QuantidadeEstoque}" 
                                            Width="80"/>
                        <DataGridCheckBoxColumn Header="Ativo" Binding="{Binding Ativo}" 
                                                Width="60" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Botões de Ação -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="Editar" Command="{Binding EditarProdutoCommand}" Width="100"/>
                    <Button Content="Desativar" Command="{Binding DesativarProdutoCommand}" 
                            Width="100" Background="#F44336"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Formulário de Produto -->
        <Border Grid.Column="1" Background="{StaticResource SurfaceColor}" 
                CornerRadius="8" Padding="20">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel>
                <TextBlock Text="{Binding ModoEdicao, Converter={StaticResource BoolToTextConverter}}" 
                           FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

                <TextBlock Text="Nome *" FontSize="12" Foreground="{StaticResource TextSecondaryColor}"/>
                <TextBox Text="{Binding Nome, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Descrição" FontSize="12" Foreground="{StaticResource TextSecondaryColor}"/>
                <TextBox Text="{Binding Descricao, UpdateSourceTrigger=PropertyChanged}" 
                         Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>

                <TextBlock Text="Preço de Venda *" FontSize="12" 
                           Foreground="{StaticResource TextSecondaryColor}"/>
                <TextBox Text="{Binding PrecoVenda, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Quantidade em Estoque" FontSize="12" 
                           Foreground="{StaticResource TextSecondaryColor}"/>
                <TextBox Text="{Binding QuantidadeEstoque, UpdateSourceTrigger=PropertyChanged}" 
                         IsEnabled="{Binding ModoEdicao, Converter={StaticResource InverseBoolConverter}}"/>

                <TextBlock Text="Código de Barras" FontSize="12" 
                           Foreground="{StaticResource TextSecondaryColor}"/>
                <TextBox Text="{Binding CodigoBarras, UpdateSourceTrigger=PropertyChanged}"/>

                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                    <Button Content="Salvar" Command="{Binding SalvarProdutoCommand}" 
                            Width="100" Background="#4CAF50"/>
                    <Button Content="Novo" Command="{Binding NovoProdutoCommand}" Width="100"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
